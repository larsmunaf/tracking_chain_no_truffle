# Tracking Chain without Truffle

This project was created for educational purposes. The use case is a delivery or tracking process which is described in this private Ethereum Blockchain. Geth is the mean of choice. Basically, there are two smart contracts running. At first, random position data is written into the Blockchain. The second contract constantly listens to events that are emitted at each writing process and keeps us up to date with notifications.

Some automation via ShellScript was done for initial steps instead of using truffle.

## Usage

Both repositories [tracking_chain](https://github.com/larsmunaf/tracking_chain) and [tracking_chain_no_tuffle](https://github.com/larsmunaf/tracking_chain_no_truffle) are required.

The first one contains the main project hierarchy generated by truffle due to easiness. The second one contains our Shellscript, 2 Ðapps (one for each contract) and a `genesis_template.json`.

Pull both repositories to your local storage. They should be located in the same project folder!

### 1 Initialization

Navigate into our "notruffle" project and execute the shellscript.
``` sh
cd tracking_chain_notruffle/
chmod +x ./initChain.sh
./initChain.sh ./genesis_block.json
```
The shellscript does the following: It kills the process that may be listening on the port where Geth should be run. Additionally, it clears any old chain data from our data directory.
Before Geth is started, two accounts are created. Their addresses get pasted into the `genesis_template.json` and are prefunded.
Then, `geth init` gets called to start our chain with the genesis block.
Finally, the geth client gets started with arguments that determine a private chain that communicates via IPC. Moreover, both accounts get unlocked to enable them to send transactions. Debugging mode is also enabled.

### 2 Mining

Now, we need to attach a console to the running geth process.

``` sh
geth attach --datadir "/home/telekom/Library/Ethereum/"
```

Secondly, in order to work with our Blockchain, the miner needs to be started. By default, the "first" account receives all mining fees. (Note: It's weird that by default the first account is the default for mining but when it comes to unlocking, the method `eth.accounts[0]` is unsafe and deprecated.) In the geth console type:

``` sh
> miner.start()
```

Before the mining starts, there is ususally a DAG being calculated, which needs some time. After that you will notice the increasing funds on our first account:

``` sh
> eth.getBalance(eth.accounts[0])

```

### 3 Deployment

To keep this project simple, Truffle is being used here once. Back into the first console type:
``` sh
cd ../tracking_chain
truffle migrate --reset --network testNet
```

### 4 Start Ðapps

``` sh
cd ../tracking_chain_notruffle
node Chain.js
node notifyAgent.js
```

### Errors

If there occur any messages that contain any hint to lacking gas or funds you may have started the Ðapps too fast. Try again after some time.
Should the problem persist, the funds on the account that executes the contract are really too low. Therefore, you need to change the mining funds going to teh second account.

``` sh
> miner.setEtherbase (eth.accounts[0...x])
```

Optionally, a simple transaction with sufficient funds will do the same.
